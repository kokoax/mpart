version: 2
jobs:
  build:
    docker:
      # - image: elixir:1.5.2
      - image: gcc:7.2.0

    working_direcotry: ~/repo

    steps:
      - checkout

      - run: apt-get update
      - run: apt-get install -y erlang libtag1-dev curl
      - run: curl -sSL https://raw.githubusercontent.com/taylor/kiex/master/install | bash -s
      - run: source "/root/.kiex/scripts/kiex" && kiex install 1.5.2

      - run: source "/root/.kiex/elixirs/elixir-1.5.2.env" && mix local.hex --force
      - run: source "/root/.kiex/elixirs/elixir-1.5.2.env" && mix local.rebar
      - run: source "/root/.kiex/elixirs/elixir-1.5.2.env" && mix deps.get
      - run: source "/root/.kiex/elixirs/elixir-1.5.2.env" && mix deps.compile
      - run: source "/root/.kiex/elixirs/elixir-1.5.2.env" && mix tes
