version: 2
jobs:
  build:
    docker:
      # - image: elixir:1.5.2
      - image: gcc:7.2.0

    working_direcotry: ~/repo

    steps:
      - checkout

      - run: pwd
      - run: cd ~
      - run: pwd

      - run: apt-get update
      - run: apt-get install -y erlang libtag1-dev curl
      - run: curl -sSL https://raw.githubusercontent.com/taylor/kiex/master/install | bash -s
      - run: ls -la /root
      - run: ls -la ~
      - run: ls -la $HOME
      - run: ls -la $HOME/.kiex
      - run: ls -la $HOME/.kiex/scripts
      - run: ls -la $HOME/.kiex/scripts/kiex
      - run: source "/root/project/.kiex/scripts/kiex"
      - run: kiex install 1.5.2
      - run: source "/root/project/.kiex/scripts/kiex/elixirs/elixir-1.5.2.env"

      - run: cd ~/repo
      - run: mix local.hex --force
      - run: mix local.rebar
      - run: mix deps.get
      - run: mix deps.compile
      - run: mix tes
